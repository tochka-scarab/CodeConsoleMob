
&НаКлиенте
Процедура ВыполнитьКод(Команда)
	Если СокрЛП(СтрокаКода) = "" Тогда
		Предупреждение("Заполните Код!");
	Иначе
		ВыполнитьНаКлиенте(СтрокаКода);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьНаКлиенте(СтрокаКода)
	Выполнить(СтрокаКода);
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьИзФайла(Команда)
	Если СокрЛП(СтрокаКода) <> "" Тогда
		#Если МобильноеПриложениеКлиент Тогда
			Предупреждение("Код будет очищен!");
		#Иначе
			ПоказатьОповещениеПользователя("Код будет очищен!");
		#КонецЕсли
		СтрокаКода = "";
		ПрочитатьФайл(СтрокаКода);
	Иначе
		ПрочитатьФайл(СтрокаКода);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПрочитатьФайл(СтрокаКода)
	
	Перем ВыбФайл, ДиалогОткрытияФайла, ИмяФайла, МассивФайлов, Режим, Строка, Строка1, Файл, Фильтр;
	
	СтрокаКода = "";
	ЭтаФорма.Заголовок = "Консоль Кода";
	#Если МобильноеПриложениеКлиент Тогда
		//Сообщить("Кнопку нажали!");
		Режим = РежимДиалогаВыбораФайла.Открытие;
		ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
		ДиалогОткрытияФайла.ПолноеИмяФайла = "";
		Фильтр = "Файл OneScript (*.os)|*.os| Файл модулей (*.bsl)|*.bsl";
		ДиалогОткрытияФайла.Фильтр = Фильтр;
		ДиалогОткрытияФайла.МножественныйВыбор = Ложь;
		ДиалогОткрытияФайла.Заголовок = "Выберите файл";
		Если ДиалогОткрытияФайла.Выбрать() Тогда
			МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
			Для Каждого ИмяФайла Из МассивФайлов Цикл
				ВыбФайл = Новый Файл(ИмяФайла);
				//Сообщить(ИмяФайла
				//    + НСтр("ru = '; Размер = '; en = '; Size = '")
				//    + ВыбФайл.Размер());
				Файл = Новый ЧтениеТекста(ИмяФайла, КодировкаТекста.UTF8);
				СтрокаКода = "";
				Строка = Файл.ПрочитатьСтроку();
				Пока Строка <> Неопределено Цикл
					Если СтрокаКода <> "" Тогда
						СтрокаКода = СтрокаКода + Символы.ПС + Строка;
					Иначе
						СтрокаКода = СтрокаКода + Строка;
					КонецЕсли; 
					Строка = Файл.ПрочитатьСтроку();
				КонецЦикла;
				//Сообщить(СтрокаКода);
				Файл.Закрыть();
				ЭтаФорма.Заголовок = ЭтаФорма.Заголовок + " : " + Сред(ИмяФайла, СтрДлина(ДиалогОткрытияФайла.Каталог) + 1);
			КонецЦикла;
		Иначе
			Предупреждение(НСтр("ru = 'Файл(ы) не выбран!'; en = 'File(s) not selected!'"));
		КонецЕсли;
	#Иначе
		Режим = РежимДиалогаВыбораФайла.Открытие;
		ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
		ДиалогОткрытияФайла.ПолноеИмяФайла = "";
		Фильтр = "Файл OneScript (*.os)|*.os| Файл модулей (*.bsl)|*.bsl";
		ДиалогОткрытияФайла.Фильтр = Фильтр;
		ДиалогОткрытияФайла.МножественныйВыбор = Ложь;
		ДиалогОткрытияФайла.Заголовок = "Выберите файл";
		Если ДиалогОткрытияФайла.Выбрать() Тогда
			//Объект.ФайлБП = ДиалогОткрытияФайла.ВыбранныеФайлы[0];
			МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
			Для Каждого ИмяФайла Из МассивФайлов Цикл
				ВыбФайл = Новый Файл(ИмяФайла);
				//Сообщить(ИмяФайла
				//    + НСтр("ru = '; Размер = '; en = '; Size = '")
				//    + ВыбФайл.Размер());
				Файл = Новый ЧтениеТекста(ИмяФайла, КодировкаТекста.UTF8);
				СтрокаКода = "";
				Строка = Файл.ПрочитатьСтроку();
				Пока Строка <> Неопределено Цикл
					Если СтрокаКода <> "" Тогда
						СтрокаКода = СтрокаКода + Символы.ПС + Строка;
					Иначе
						СтрокаКода = СтрокаКода + Строка;
					КонецЕсли; 
					Строка = Файл.ПрочитатьСтроку();
				КонецЦикла;
				//Сообщить(СтрокаКода);
				Файл.Закрыть();
				ЭтаФорма.Заголовок = ЭтаФорма.Заголовок + " : " + Сред(ИмяФайла, СтрДлина(ДиалогОткрытияФайла.Каталог) + 1);
			КонецЦикла;
		КонецЕсли;
	#КонецЕсли

КонецПроцедуры

&НаКлиенте
Процедура СохранитьВФайл(Команда)
	АдресВоВременномХранилище = ПоместитьВоВременноеХранилище(СтрокаКода, УникальныйИдентификатор);
	ПолучитьФайл(АдресВоВременномХранилище, , Истина);
КонецПроцедуры
